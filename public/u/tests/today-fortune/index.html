<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 운세 - ESFP</title>
    <link rel="stylesheet" href="/u/tests/assets/css/main.css?20251010120000">
    <style>
        /* Custom styles are now handled by main.css through .info-card */
        .card-title .icon {
            display: inline-block;
            margin-right: 0.5em;
            font-style: normal;
        }
    </style>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">ESFP.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links"></nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>

    <div class="container">
        <h1>오늘의 ESFP 운세</h1>
        <div id="fortuneContent">
            <div class="card info-card">
                <div class="card-title"><span class="icon">💡</span> 오늘의 조언</div>
                <p id="adviceDisplay">조언을 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📝</span> 오늘의 과제</div>
                <p id="taskDisplay">과제를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📈</span> ESFP 지수</div>
                <p id="intpIndexDisplay">ESFP 지수를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">🔑</span> 행운의 키워드</div>
                <p id="keywordDisplay">키워드를 불러오는 중...</p>
            </div>
        </div>
    </div>

    <script src="/u/tests/assets/js/main.js?20251010170000" defer></script>
    <script src="/u/tests/assets/js/dynamic-menu.js?20251010170000" defer></script>
    <script>
    function getDailySeed() {
        const today = new Date();
        return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
    }

    function mulberry32(seed) {
        return function() {
            seed |= 0;
            seed = seed + 0x6D2B79F5 | 0;
            let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
            t = t + Math.imul(t ^ t >>> 7, 61 | t) | 0;
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    /**
     * 한국어 조사(e.g., 은/는, 을/를)를 앞 단어의 받침 유무에 따라 올바르게 선택하는 함수
     * @param {string} text - 조사가 붙을 단어
     * @param {string} particle - '/'로 구분된 조사 쌍 (예: "을/를")
     * @returns {string} - 선택된 조사
     */
    function josa(text, particle) {
        const particles = particle.split('/');
        if (particles.length < 2) return particle;

        if (typeof text !== 'string' || text.length === 0) return particles[1];
        const lastChar = text[text.length - 1];
        const charCode = lastChar.charCodeAt(0);

        // 한글 (가-힣) 범위 체크
        if (charCode < 0xAC00 || charCode > 0xD7A3) {
            // 한글이 아니면 기본값(받침 없는 경우) 반환
            return particles[1];
        }

        const hasBatchim = (charCode - 0xAC00) % 28 > 0;
        return hasBatchim ? particles[0] : particles[1];
    }

    // --- Enhanced Generative Data Parts ---
    const data = {
        advice: {
            openings: ["오늘은", "오늘 당신의", "지금은", "오늘은 특별히"],
            subjects: ["활기찬 에너지가", "새로운 경험에 대한 열정이", "뛰어난 대인 관계 기술이", "주변의 아름다움이", "자발적인 행동이"],
            verbs: ["빛을 발하는 날입니다.", "새로운 기회로 이끌 것입니다.", "주변 사람들에게 영감을 줍니다.", "예상치 못한 즐거움을 가져다줍니다.", "당신을 한 단계 성장시킬 것입니다."],
            connectors: ["따라서", "그러니", "이 기회를 빌어", "망설이지 말고"],
            actions: ["새로운 사람들과 교류하며 즐거운 시간을 보내세요.", "자신만의 방식으로 개성을 표현해 보세요.", "즉흥적인 모험을 떠나 새로운 것을 발견하세요.", "주변 사람들에게 긍정적인 에너지를 전달하세요.", "실용적인 활동을 통해 새로운 기술을 배워보세요."]
        },
        task: {
            types: ["즐기기:", "표현하기:", "경험하기:", "교류하기:"],
            actions: ["평소 관심 있었던", "새롭게 시도하고 싶은", "흥미를 느꼈던", "사람들과 함께 할 수 있는"],
            subjects: ["예술 활동", "새로운 취미", "사회적 모임", "즉흥적인 여행", "패션 스타일링", "봉사 활동"],
            verbs: ["을(를) 통해 자신을 표현해 보세요.", "의 핵심을 파악하고 직접 경험해 보세요.", "을(를) 다른 사람과 공유해 보세요.", "과/와 관련된 새로운 아이디어를 3가지 이상 기록해 보세요.", "의 즐거움을 만끽해 보세요."]
        },
        esfpIndex: {
            reasons: ["활기찬 에너지가 넘쳐흘러", "새로운 경험에 대한 열정이 불타올라", "뛰어난 대인 관계 기술이 빛을 발하여", "주변의 아름다움을 깊이 있게 느끼며", "자발적인 행동으로 새로운 기회를 창출하여"],
            results: ["주변 사람들에게 긍정적인 영향을 줍니다.", "삶의 즐거움을 최대한으로 누릴 수 있습니다.", "새로운 도전을 성공적으로 이끌 수 있습니다.", "창의적인 아이디어를 현실로 만들 가능성이 높습니다.", "사회적 관계에서 큰 만족감을 느낄 수 있습니다."]
        },
        keywords: ["연예인", "엔터테이너", "활기찬", "자발적인", "외향적인", "친근한", "열정적인", "현재 지향적인", "실용적인", "적응력", "유연한", "관찰력", "공감", "대인 관계 기술", "낙천적인", "배우", "가수", "댄서", "이벤트 기획자", "영업 전문가", "스포츠 선수", "패션 디자이너", "여행 가이드", "상담사"]
    };

    // --- Generator Functions ---
    function generateAdvice(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const structureType = randFn();
        if (structureType < 0.4) {
            // Structure 1: Subject + Verb
            return `${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else if (structureType < 0.8) {
            // Structure 2: Opening + Subject + Verb
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else {
            // Structure 3: Full Sentence
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)} ${pick(parts.connectors)} ${pick(parts.actions)}`;
        }
    }

    function generateTask(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const type = pick(parts.types);
        const action = pick(parts.actions);
        const subject = pick(parts.subjects);
        const verb = pick(parts.verbs);

        // 문장 조합: action + subject + verb
        let rawSentence = `${action} ${subject}${verb}`;

        // 조사 처리
        rawSentence = rawSentence
            .replace("을(를)", josa(subject, "을/를"))
            .replace("은(는)", josa(subject, "은/는"))
            .replace("이(가)", josa(subject, "이/가"))
            .replace("과/와", josa(subject, "과/와"));

        return `${type} ${rawSentence}`;
    }

    function generateEsfpIndex(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        const percentage = 65 + Math.floor(randFn() * 31); // 65% to 95%
        return `${percentage}% - ${pick(parts.reasons)} ${pick(parts.results)}`;
    }

    function generateKeywords(randFn, keywords, count) {
        const shuffled = [...keywords].sort(() => randFn() - 0.5);
        return shuffled.slice(0, count).map(k => `#${k}`).join(" ");
    }

    // --- Main Execution ---
    window.onload = function() {
        try {
            const seed = getDailySeed();
            const randFn = mulberry32(seed);

            document.getElementById('adviceDisplay').innerText = generateAdvice(randFn, data.advice);
            document.getElementById('taskDisplay').innerText = generateTask(randFn, data.task);
            document.getElementById('intpIndexDisplay').innerText = generateEsfpIndex(randFn, data.esfpIndex); // Changed to generateEsfpIndex
            document.getElementById('keywordDisplay').innerText = generateKeywords(randFn, data.keywords, 5);
        } catch (e) {
            console.error("오늘의 운세 생성 중 오류 발생:", e);
            document.getElementById('adviceDisplay').innerText = "콘텐츠를 불러오는 데 실패했습니다. 페이지를 새로고침해 주세요.";
        }
    };
</script>
</body>
</html>