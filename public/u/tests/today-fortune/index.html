<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 운세 - ESFP</title>
    <link rel="stylesheet" href="/u/tests/assets/css/main.css?20251010120000">
    <style>
        /* Custom styles are now handled by main.css through .info-card */
        .card-title .icon {
            display: inline-block;
            margin-right: 0.5em;
            font-style: normal;
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4262871645049971" crossorigin="anonymous"></script>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">ESFP.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links"></nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>

    <div class="container">
        <h1>오늘의 ESFP 운세</h1>
        
        <div class="content-card">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-4262871645049971"
                data-ad-slot="2065367733"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <div id="fortuneContent">
            <div class="card info-card">
                <div class="card-title"><span class="icon">💡</span> 오늘의 조언</div>
                <p id="adviceDisplay">조언을 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📝</span> 오늘의 과제</div>
                <p id="taskDisplay">과제를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📈</span> ESFP 지수</div>
                <p id="mbtiIndexDisplay">ESFP 지수를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">🔑</span> 행운의 키워드</div>
                <p id="keywordDisplay">키워드를 불러오는 중...</p>
            </div>
        </div>
        
        <div class="content-card">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-format="autorelaxed"
                data-ad-client="ca-pub-4262871645049971"
                data-ad-slot="5813041058"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <div id="giscus-container" style="margin: 15px 0;"></div>
        <script>
            function loadGiscus() {
                const container = document.getElementById('giscus-container');
                while (container.firstChild) container.removeChild(container.firstChild);
                
                const script = document.createElement('script');
                script.src = 'https://giscus.app/client.js';
                script.setAttribute('data-repo', 'OUS-KR/ESFP.KR');
                script.setAttribute('data-repo-id', 'R_kgDOOrfScQ');
                script.setAttribute('data-category', 'Announcements');
                script.setAttribute('data-category-id', 'DIC_kwDOOrfScc4CqQAN');
                script.setAttribute('data-mapping', 'pathname');
                script.setAttribute('data-strict', '0');
                script.setAttribute('data-reactions-enabled', '1');
                script.setAttribute('data-emit-metadata', '1');
                script.setAttribute('data-input-position', 'top');
                script.setAttribute('data-theme', localStorage.getItem('theme') ?? 'light');
                script.setAttribute('data-loading', 'lazy');
                script.setAttribute('data-lang', 'ko');
                script.setAttribute('crossorigin', 'anonymous');
                script.setAttribute('async', '');
                
                container.appendChild(script);
            }
            
            loadGiscus();
        </script>
        
        <div class="content-card">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-format="autorelaxed"
                data-ad-client="ca-pub-4262871645049971"
                data-ad-slot="5813041058"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>

    <script src="/u/tests/assets/js/main.js?20251020100800" defer></script>
    <script src="/u/tests/assets/js/dynamic-menu.js?20251010170000" defer></script>
    <script>
    function getDailySeed() {
        const today = new Date();
        return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
    }

    function mulberry32(seed) {
        return function() {
            seed |= 0;
            seed = seed + 0x6D2B79F5 | 0;
            let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
            t = t + Math.imul(t ^ t >>> 7, 61 | t) | 0;
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    /**
     * 한국어 조사(e.g., 은/는, 을/를)를 앞 단어의 받침 유무에 따라 올바르게 선택하는 함수
     * @param {string} text - 조사가 붙을 단어
     * @param {string} particle - '/'로 구분된 조사 쌍 (예: "을/를")
     * @returns {string} - 선택된 조사
     */
    function josa(text, particle) {
        const particles = particle.split('/');
        if (particles.length < 2) return particle;

        if (typeof text !== 'string' || text.length === 0) return particles[1];
        const lastChar = text[text.length - 1];
        const charCode = lastChar.charCodeAt(0);

        // 한글 (가-힣) 범위 체크
        if (charCode < 0xAC00 || charCode > 0xD7A3) {
            // 한글이 아니면 기본값(받침 없는 경우) 반환
            return particles[1];
        }

        const hasBatchim = (charCode - 0xAC00) % 28 > 0;
        return hasBatchim ? particles[0] : particles[1];
    }

    // --- Enhanced Generative Data Parts (ESFP) ---
    const data = {
        advice: {
            openings: ["오늘은", "오늘 당신의", "지금은", "오늘은 특별히"],
            subjects: ["당신의 밝고 긍정적인 에너지가", "주변을 즐겁게 만드는 재능이", "현재를 즐기는 낙천적인 태도가", "새로운 경험에 대한 개방성이", "뛰어난 순발력과 적응력이"],
            verbs: ["주변 사람들에게 활력을 불어넣습니다.", "당신을 모임의 중심으로 만들어 줍니다.", "사소한 걱정거리를 잊게 만듭니다.", "예상치 못한 행운을 가져다줄 것입니다.", "어떤 위기 상황도 슬기롭게 극복하게 합니다."],
            connectors: ["그러니", "이 기회를 활용해", "자신감을 갖고", "망설이지 말고"],
            actions: ["당신의 유머 감각으로 주변 사람들을 웃게 만들어 보세요.", "새로운 음악을 듣거나 맛있는 음식을 즐기며 오감을 만족시키세요.", "계획에 없던 즉흥적인 약속을 잡아보세요.", "평소와 다른 스타일의 옷을 입고 기분 전환을 해보세요.", "몸을 움직이는 활동적인 취미를 즐겨보세요."]
        },
        task: {
            types: ["즐기기:", "표현하기:", "도전하기:", "공유하기:"],
            actions: ["오늘 당신을 가장 즐겁게 하는", "당신의 흥을 돋우는", "한 번도 해보지 않았던", "최근 당신이 발견한"],
            subjects: ["음악", "패션 아이템", "새로운 활동", "멋진 장소"],
            verbs: ["을(를) 온몸으로 즐겨보세요.", "을(를) 사진이나 영상으로 남겨보세요.", "에 과감하게 도전하고 경험을 공유해 보세요.", "를 친구들에게 소개하고 함께 즐겨보세요."]
        },
        mbtiIndex: {
            reasons: ["넘치는 긍정 에너지가 주변을 밝게 만들어", "뛰어난 순발력으로 어떤 상황에도 유연하게 대처하여", "사람들의 시선을 사로잡는 매력이 폭발하여", "현재를 즐기는 감각적인 즐거움이 가득하여"],
            results: ["모임의 주인공이 될 가능성이 높습니다.", "예상치 못한 위기도 즐거운 이벤트로 바꿀 수 있습니다.", "당신의 매력에 많은 사람들이 빠져들게 됩니다.", "일상의 모든 순간이 특별한 경험이 됩니다."]
        },
        keywords: ["외향적인", "사교적인", "낙천적인", "긍정적인", "현실적인", "실제적인", "감각적인", "예술적인", "즉흥적인", "활동적인", "관찰력 있는", "재치 있는", "유머러스한", "연예인", "분위기 메이커", "경험 중시", "자유로운 영혼", "적응력", "친화력", "열정적"]
    };

    // --- Generator Functions ---
    function generateAdvice(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const structureType = randFn();
        if (structureType < 0.4) {
            // Structure 1: Subject + Verb
            return `${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else if (structureType < 0.8) {
            // Structure 2: Opening + Subject + Verb
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else {
            // Structure 3: Full Sentence
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)} ${pick(parts.connectors)} ${pick(parts.actions)}`;
        }
    }

    function generateTask(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const type = pick(parts.types);
        const action = pick(parts.actions);
        const subject = pick(parts.subjects);
        const verb = pick(parts.verbs);

        // 문장 조합: action + subject + verb
        let rawSentence = `${action} ${subject}${verb}`;

        // 조사 처리
        rawSentence = rawSentence
            .replace("을(를)", josa(subject, "을/를"))
            .replace("은(는)", josa(subject, "은/는"))
            .replace("이(가)", josa(subject, "이/가"))
            .replace("과/와", josa(subject, "과/와"));

        return `${type} ${rawSentence}`;
    }

    function generateMbtiIndex(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        const percentage = 65 + Math.floor(randFn() * 31); // 65% to 95%
        return `${percentage}% - ${pick(parts.reasons)} ${pick(parts.results)}`;
    }

    function generateKeywords(randFn, keywords, count) {
        const shuffled = [...keywords].sort(() => randFn() - 0.5);
        return shuffled.slice(0, count).map(k => `#${k}`).join(" ");
    }

    // --- Main Execution ---
    window.onload = function() {
        try {
            const seed = getDailySeed();
            const randFn = mulberry32(seed);

            document.getElementById('adviceDisplay').innerText = generateAdvice(randFn, data.advice);
            document.getElementById('taskDisplay').innerText = generateTask(randFn, data.task);
            document.getElementById('mbtiIndexDisplay').innerText = generateMbtiIndex(randFn, data.mbtiIndex);
            document.getElementById('keywordDisplay').innerText = generateKeywords(randFn, data.keywords, 5);
        } catch (e) {
            console.error("오늘의 운세 생성 중 오류 발생:", e);
            document.getElementById('adviceDisplay').innerText = "콘텐츠를 불러오는 데 실패했습니다. 페이지를 새로고침해 주세요.";
        }
    };
</script>
</body>
</html>